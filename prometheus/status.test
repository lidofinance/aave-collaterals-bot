---
rule_files: 
  - "status.rule"
evaluation_interval: 1m
tests:
  # TooLowUpdates
  - interval: 5m
    input_series:
      - series: aave_bot_collateral_percentage{zone="D"}
        values: 0+0x5 1+0x5
      - series: aave_bot_collateral_percentage{zone="C"}
        values: 0+0x5 1+0x5
    alert_rule_test:
      - eval_time: 1h
        alertname: TooLowUpdates 
        exp_alerts:
          - exp_labels:
              zone: D
              severity: warning
              stage: testing
            exp_annotations:
              summary: Too low AAVE bot's updates count has been detected!
          - exp_labels:
              zone: C
              severity: warning
              stage: testing
            exp_annotations:
              summary: Too low AAVE bot's updates count has been detected!
  # ProcessRestarted
  - interval: 5m 
    input_series:
      - series: process_start_time_seconds{job="collaterals"}
        values: 0 1 2 3 4 5
    alert_rule_test:
      # event should fire
      - eval_time: 15m
        alertname: ProcessRestarted 
        exp_alerts:
          - exp_labels:
              severity: warning
              stage: testing
              job: collaterals
            exp_annotations:
              summary: Too much AAVE bot restarts
              description: The AAVE bot has been restarted for 3 times for the last 15 minutes

# vim: set ts=2 sw=2 ft=yaml:
